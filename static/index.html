<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LLM Router</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Syne:wght@600;700;800&display=swap" rel="stylesheet"/>

<style>
  /* ─── reset & variables ────────────────────────────────────────── */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg:          #f5f7fa;
    --surface:     #ffffff;
    --surface-hi:  #fafbfc;
    --border:      #e1e4e8;
    --text:        #24292e;
    --text-dim:    #6a737d;
    --accent:      #0366d6;
    --accent-dim:  rgba(3,102,214,.1);
    --easy:        #28a745;
    --easy-bg:     rgba(40,167,69,.1);
    --medium:      #f66a0a;
    --medium-bg:   rgba(246,106,10,.1);
    --complex:     #d73a49;
    --complex-bg:  rgba(215,58,73,.1);
    --radius:      8px;
    --sidebar:     #fafbfc;
  }

  html { font-size: 16px; }
  body {
    font-family: 'IBM Plex Mono', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    display: flex;
    line-height: 1.6;
    margin: 0;
  }

  /* ─── layout ───────────────────────────────────────────────────── */
  .container {
    display: flex;
    width: 100%;
    min-height: 100vh;
  }

  /* ─── sidebar ──────────────────────────────────────────────────── */
  .sidebar {
    width: 280px;
    background: var(--sidebar);
    border-right: 1px solid var(--border);
    padding: 24px 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
  }

  .history-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }
  .history-header h3 {
    font-family: 'Syne', sans-serif;
    font-size: .8rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: .08em;
    color: var(--text-dim);
  }
  .clear-btn {
    background: none;
    border: none;
    font-family: inherit;
    font-size: .7rem;
    color: var(--text-dim);
    cursor: pointer;
    transition: color .2s;
    padding: 4px 8px;
  }
  .clear-btn:hover { color: var(--complex); }

  .history-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }
  .history-item {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    animation: fadeUp .2s ease;
    transition: box-shadow .2s;
  }
  .history-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,.08);
  }
  .history-item .h-prompt {
    font-size: .72rem;
    color: var(--text-dim);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-weight: 500;
  }
  .history-item .h-response {
    font-size: .75rem;
    color: var(--text);
    white-space: pre-wrap;
    word-break: break-word;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .empty-state {
    text-align: center;
    padding: 32px 16px;
    color: var(--text-dim);
    font-size: .75rem;
    font-style: italic;
  }

  /* ─── main content ─────────────────────────────────────────────── */
  .main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 48px 24px;
    overflow-y: auto;
  }

  .content {
    width: 100%;
    max-width: 680px;
    display: flex;
    flex-direction: column;
    gap: 32px;
  }

  /* ─── header ───────────────────────────────────────────────────── */
  .header {
    display: flex;
    flex-direction: column;
    gap: 8px;
    text-align: center;
    padding: 24px 0;
  }
  .header h1 {
    font-family: 'Syne', sans-serif;
    font-weight: 800;
    font-size: 2.5rem;
    color: var(--text);
    letter-spacing: -0.02em;
    line-height: 1.1;
  }
  .header h1 span { color: var(--accent); }
  .header p {
    font-size: .82rem;
    color: var(--text-dim);
    letter-spacing: .02em;
  }

  /* ─── input card ───────────────────────────────────────────────── */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: 0 1px 3px rgba(0,0,0,.06);
  }

  .input-row {
    display: flex;
    gap: 12px;
    align-items: flex-end;
  }

  textarea {
    flex: 1;
    resize: vertical;
    min-height: 80px;
    background: var(--surface-hi);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    color: var(--text);
    font-family: inherit;
    font-size: .88rem;
    padding: 14px 16px;
    outline: none;
    transition: border-color .2s, box-shadow .2s;
  }
  textarea:focus { 
    border-color: var(--accent); 
    box-shadow: 0 0 0 3px var(--accent-dim);
  }
  textarea::placeholder { color: var(--text-dim); }

  .btn {
    flex-shrink: 0;
    background: var(--accent);
    color: #fff;
    border: none;
    border-radius: var(--radius);
    font-family: 'Syne', sans-serif;
    font-weight: 700;
    font-size: .82rem;
    text-transform: uppercase;
    letter-spacing: .06em;
    padding: 14px 24px;
    cursor: pointer;
    transition: background .2s, transform .1s;
    align-self: stretch;
  }
  .btn:hover { background: #0256c2; }
  .btn:active { transform: scale(.97); }
  .btn:disabled { opacity: .5; cursor: not-allowed; transform: none; }

  /* ─── status bar ───────────────────────────────────────────────── */
  .status-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 12px;
    min-height: 22px;
  }
  .spinner {
    width: 14px; height: 14px;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin .6s linear infinite;
    display: none;
  }
  .spinner.active { display: block; }
  @keyframes spin { to { transform: rotate(360deg); } }

  .status-text {
    font-size: .75rem;
    color: var(--text-dim);
    font-style: italic;
  }

  /* ─── response card ────────────────────────────────────────────── */
  .response-card {
    display: none;
    flex-direction: column;
    gap: 16px;
    animation: fadeUp .3s ease;
  }
  .response-card.visible { display: flex; }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .response-text {
    font-size: .88rem;
    color: var(--text);
    line-height: 1.75;
    white-space: pre-wrap;
    word-break: break-word;
  }

  /* ─── error toast ──────────────────────────────────────────────── */
  .error-toast {
    display: none;
    background: var(--complex-bg);
    border: 1px solid var(--complex);
    border-radius: var(--radius);
    padding: 14px 18px;
    font-size: .78rem;
    color: var(--complex);
    animation: fadeUp .25s ease;
  }
  .error-toast.visible { display: block; }

  /* ─── responsive ───────────────────────────────────────────────── */
  @media (max-width: 768px) {
    .sidebar {
      display: none;
    }
    .header h1 {
      font-size: 2rem;
    }
  }
</style>
</head>
<body>

<div class="container">
  
  <!-- sidebar with history -->
  <div class="sidebar">
    <div class="history-header">
      <h3>History</h3>
      <button class="clear-btn" id="clearBtn">Clear</button>
    </div>
    <div class="history-list" id="historyList">
      <div class="empty-state" id="emptyState">No queries yet</div>
    </div>
  </div>

  <!-- main content area -->
  <div class="main">
    <div class="content">

      <!-- centered header -->
      <div class="header">
        <h1>LLM <span>Router</span></h1>
        <p>Cost-controlled model routing · classify → route → respond</p>
      </div>

      <!-- input -->
      <div class="card">
        <div class="input-row">
          <textarea id="promptInput" placeholder="Ask me anything…" rows="3"></textarea>
          <button class="btn" id="sendBtn">Send</button>
        </div>
        <div class="status-bar">
          <div class="spinner" id="spinner"></div>
          <span class="status-text" id="statusText"></span>
        </div>
      </div>

      <!-- error -->
      <div class="error-toast" id="errorToast"></div>

      <!-- live response -->
      <div class="response-card card" id="responseCard">
        <div class="response-text" id="responseText"></div>
      </div>

    </div>
  </div>

</div>

<script>
// ─── config ───────────────────────────────────────────────────────────────
const API_URL = "/route";

// ─── DOM refs ─────────────────────────────────────────────────────────────
const promptInput   = document.getElementById("promptInput");
const sendBtn       = document.getElementById("sendBtn");
const spinner       = document.getElementById("spinner");
const statusText    = document.getElementById("statusText");
const errorToast    = document.getElementById("errorToast");
const responseCard  = document.getElementById("responseCard");
const responseText  = document.getElementById("responseText");
const historyList   = document.getElementById("historyList");
const emptyState    = document.getElementById("emptyState");
const clearBtn      = document.getElementById("clearBtn");

// ─── in-memory history ────────────────────────────────────────────────────
let history = [];

// ─── helpers ──────────────────────────────────────────────────────────────
function setLoading(on) {
  sendBtn.disabled = on;
  spinner.classList.toggle("active", on);
}

function showError(msg) {
  errorToast.textContent = msg;
  errorToast.classList.add("visible");
  setTimeout(() => errorToast.classList.remove("visible"), 4000);
}

function hideResponse() {
  responseCard.classList.remove("visible");
  responseText.textContent = "";
}

function showResponse(data) {
  responseText.textContent = data.llm_response || "";
  responseCard.classList.add("visible");
}

function addToHistory(prompt, data) {
  history.unshift({ prompt, ...data });
  renderHistory();
}

function renderHistory() {
  // remove old items (keep emptyState node)
  [...historyList.querySelectorAll(".history-item")].forEach(el => el.remove());

  if (history.length === 0) {
    emptyState.style.display = "block";
    return;
  }
  emptyState.style.display = "none";

  history.forEach(item => {
    const el = document.createElement("div");
    el.className = "history-item";

    el.innerHTML = `
      <div class="h-prompt">${escHtml(item.prompt)}</div>
      <div class="h-response">${escHtml(item.llm_response || "")}</div>
    `;
    historyList.appendChild(el);
  });
}

function escHtml(s) {
  const d = document.createElement("div");
  d.appendChild(document.createTextNode(s));
  return d.innerHTML;
}

// ─── send request ─────────────────────────────────────────────────────────
async function send() {
  const prompt = promptInput.value.trim();
  if (!prompt) return;

  setLoading(true);
  hideResponse();
  statusText.textContent = "Classifying & routing…";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { 
        "Content-Type": "application/json"
      },
      credentials: "include",
      body: JSON.stringify({ prompt }),
    });

    if (!res.ok) {
      let errorMsg = `Server error ${res.status}`;
      try {
        const err = await res.json();
        errorMsg = err.detail || errorMsg;
      } catch (e) {
        // If response is not JSON, get text
        const text = await res.text();
        if (text) errorMsg = text;
      }
      throw new Error(errorMsg);
    }

    const data = await res.json();
    statusText.textContent = "";
    showResponse(data);
    addToHistory(prompt, data);
    promptInput.value = "";
    promptInput.focus();

  } catch (e) {
    statusText.textContent = "";
    showError(e.message || "Something went wrong.");
    console.error("Fetch error:", e);
  } finally {
    setLoading(false);
  }
}

// ─── events ───────────────────────────────────────────────────────────────
sendBtn.addEventListener("click", send);

promptInput.addEventListener("keydown", (e) => {
  // Shift+Enter → newline, plain Enter → send
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    send();
  }
});

clearBtn.addEventListener("click", () => {
  history = [];
  renderHistory();
});
</script>

</body>
</html>